{{ 'everlane-header.css' | asset_url | stylesheet_tag }}
{{ 'secondary-nav.css' | asset_url | stylesheet_tag }}
<script src="{{ 'mega-menu.js' | asset_url }}" defer></script>

<header class="everlane-header" role="banner">
  <div class="everlane-header__sticky">

    <!-- ROW 1: PRIMARY HEADER -->
    <div class="everlane-header__top">
      
      <!-- LEFT: Primary Nav -->
      <nav class="everlane-header__primary-nav" aria-label="Primary">
        <ul class="everlane-header__primary">
        {% for link in linklists['main-menu-custom'].links %}
          <li>
            <a
              href="{{ link.url }}"
              class="{% if link.current %}is-active{% endif %}"
            >
              {{ link.title }}
            </a>
          </li>
        {% endfor %}
        </ul>
      </nav>

      <!-- CENTER: LOGO -->
      <a href="{{ routes.root_url }}" class="everlane-header__logo">
        {{ shop.name }}
      </a>

      <!-- RIGHT: ICONS -->
      <div class="everlane-header__icons">
        <a href="{{ routes.search_url }}">Search</a>
        <a href="{{ routes.account_url }}">Account</a>
        <a href="{{ routes.cart_url }}">Bag</a>
      </div>

    </div>

    <!-- ROW 2: SECONDARY NAV -->
      {% assign current_menu = nil %}

      {% for link in linklists['main-menu-custom'].links %}
        {% if link.current %}
          {% assign menu_handle = link.title | downcase | append: '-secondary-menu' %}
          {% assign current_menu = linklists[menu_handle] %}
        {% endif %}
      {% endfor %}

      {% if request.page_type == 'index' %}
        {% assign current_menu = linklists['women-secondary-menu'] %}
      {% endif %}



    {% if request.page_type == 'index' %}
      {% assign current_menu = linklists['women-secondary-menu'] %}
    {% endif %}

    {% if current_menu %}
      <nav class="secondary-nav" aria-label="Secondary navigation">
        <div class="secondary-nav__inner">
          <ul class="secondary-nav__menu">
            {% for link in current_menu.links %}
              <li class="secondary-nav__item" data-mega="{{ link.title | handle }}">
                <a
                  href="{{ link.url }}"
                  class="secondary-nav__link
                        {% if link.current %} is-active{% endif %}
                        {% if link.title == 'Sale' %} sale{% endif %}"
                >
                  {{ link.title }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </nav>
      {% endif %}
      <!-- SINGLE MEGA MENU PANEL -->
<div class="mega-menu">
  <div class="mega-menu__inner page-width">

    {% assign active_primary = nil %}

    {% for primary in linklists['main-menu-custom'].links %}
      {% if primary.current %}
        {% assign active_primary = primary.title | handle %}
      {% endif %}
    {% endfor %}

    {% if request.page_type == 'index' %}
      {% assign active_primary = 'women' %}
    {% endif %}

    {% for link in current_menu.links %}
      {% assign secondary_handle = link.title | handle %}
      {% assign mega_handle = active_primary | append: '-' | append: secondary_handle | append: '-mega' %}
      {% assign mega_menu = linklists[mega_handle] %}

      {% if mega_menu and mega_menu.links.size > 0 %}
        <div class="mega-panel" data-panel="{{ secondary_handle }}">
          
          {% for column in mega_menu.links %}
            <div class="mega-menu__column">
              <h4>{{ column.title }}</h4>

              {% for sublink in column.links %}
                <a href="{{ sublink.url }}">
                  {{ sublink.title }}
                </a>
              {% endfor %}
            </div>
          {% endfor %}

          <div class="mega-menu__image">
            <img 
              src="{{ 'everlane-megamenu.jpg' | asset_url }}"
              width="180"
              height="180"
              alt="Shop Collection"
            >
            <p>SHOP COLLECTION</p>
          </div>

        </div>
      {% endif %}
    {% endfor %}

  </div>
</div>
  </div>
</header>

{% schema %}
{
  "name": "Everlane Header"
}
{% endschema %}
